---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMSingle
metadata:
  name: stack
spec:
  image:
    tag: v1.100.1
  extraArgs:
    vmalert.proxyURL: http://vmalert-stack.observability.svc:8080
  replicaCount: 1
  # -- Data retention period. Possible units character: h(ours), d(ays), w(eeks), y(ears), if no unit character specified - month. The minimum retention period is 24h. See these [docs](https://docs.victoriametrics.com/single-server-victoriametrics/#retention)
  retentionPeriod: 2d
  storage:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: 10Gi
    storageClassName: openebs-hostpath
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMAgent
metadata:
  name: stack
spec:
  image:
    tag: v1.100.1
  externalLabels:
    cluster: talos-dev
  extraArgs:
    promscrape.streamParse: "true"
    # Do not store original labels in vmagent's memory by default. This reduces the amount of memory used by vmagent
    # but makes vmagent debugging UI less informative. See: https://docs.victoriametrics.com/vmagent/#relabel-debug
    promscrape.dropOriginalLabels: "true"
  remoteWrite:
    - url: http://vmsingle-stack.observability.svc:8429/api/v1/write
  scrapeInterval: 30s
  selectAllByDefault: true
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMAlertmanager
metadata:
  name: stack
  labels:
    app.kubernetes.io/component: vm-alertmanager
spec:
  image:
    tag: v0.25.0
  configSecret: alertmanager-config
  externalURL: http://vmalertmanager-stack.observability.svc:9093
  routePrefix: /
  portName: http-web
  selectAllByDefault: true
  storage:
    volumeClaimTemplate:
      spec:
        storageClassName: openebs-hostpath
        resources:
          requests:
            storage: 1Gi
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMAlert
metadata:
  name: stack
spec:
  image:
    tag: v1.100.1
  datasource:
    url: http://vmsingle-stack.observability.svc:8429
  evaluationInterval: 30s
  externalLabels:
    cluster: talos-dev
  notifiers:
    - url: http://vmalertmanager-stack.observability.svc:9093
  remoteRead:
    url: http://vmsingle-stack.observability.svc:8429
  remoteWrite:
    url: http://vmsingle-stack.observability.svc:8429/api/v1/write
  selectAllByDefault: true
