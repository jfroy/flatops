logging {
	level    = "warn"
	format   = "json"
	write_to = [loki.write.victorialogs.receiver]
}

prometheus.exporter.self "default" { }

prometheus.scrape "metamonitoring" {
	targets    = prometheus.exporter.self.default.targets
	forward_to = [prometheus.remote_write.victoriametrics.receiver]
}

prometheus.exporter.unix "default" {
	enable_collectors  = ["drbd", "ksmd"]
	disable_collectors = ["btrfs", "mdadm", "tapestats"]
}

prometheus.scrape "nodeexporter" {
	targets         = prometheus.exporter.unix.default.targets
	forward_to      = [prometheus.remote_write.victoriametrics.receiver]
  job_name        = "node-exporter"
	body_size_limit = "32MiB"
}

prometheus.remote_write "victoriametrics" {
	endpoint {
		url = "http://vmsingle-stack.observability.svc:8429/prometheus/api/v1/write"
	}
}

loki.write "victorialogs" {
	endpoint {
		url = "http://victoria-logs.observability.svc:9428/insert/loki/api/v1/push?_stream_fields=instance,job,host,app"
	}
}

// prometheus.scrape "nodeexporter" {
//   targets = prometheus.exporter.unix.nodeexporter.targets
//   forward_to = [otelcol.receiver.prometheus.victoriametrics.receiver]
// }

// otelcol.receiver.prometheus "victoriametrics" {
//   output {
//     metrics = [otelcol.processor.batch.batch.input]
//   }
// }

// otelcol.processor.batch "batch" {
//   output {
//     metrics = [otelcol.exporter.otlphttp.victoriametrics.input]
//   }
// }

// otelcol.exporter.otlphttp "victoriametrics" {
//   client {
//     endpoint = "http://<victoriametrics-addr>:<victoriametrics_port>/opentelemetry"
//   }
// }
